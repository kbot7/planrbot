@inject HttpClient Http
@inject ILogger<DayToDoListCard> Logger
@using Planrbot.Frontend.Store;
@using Planrbot.Models;

<MudCard>
    <MudCardHeader>
        <MudText Typo="Typo.h6" GutterBottom="true">@Day - @Items.First().Date.ToString("MM-dd")</MudText>
    </MudCardHeader>
    <MudCardContent>
        @foreach (var item in Items.Where(t => t.Date.DayOfWeek == Day))
        {
            <MudCheckBox @bind-Checked="@item.IsComplete" @bind-Checked:after="() => ItemChanged(item)" Label="@item.Description" Color="Color.Primary" />
        }
    </MudCardContent>
    <MudCardActions>
        <MudButton Variant="Variant.Text" Color="Color.Primary">Day View</MudButton>
    </MudCardActions>
</MudCard>

@code {
    [Parameter]
    public DayOfWeek Day { get; set; }

    [Parameter]
    public IEnumerable<PlanrTask> Items { get; set; }

    [Inject]
    public IDispatcher? Dispatcher { get; set; }

    private Task ItemChanged(PlanrTask item)
    {
        Logger.LogInformation("Item Changed | Item: {0}", item);
        var updateAction = new UpdateTask(item);
        Dispatcher?.Dispatch(updateAction);
        return Task.CompletedTask;
    }
}
